<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data cleaning: Merging 2 large data sets with dplyr • wildlifeR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">wildlifeR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ANOVA_deer_antlers.html">Intro to 1-way ANOVA: impacts of diet on deer antlers</a>
    </li>
    <li>
      <a href="../articles/data_cleaning_dplyr_filter.html">Data Cleaning: Filtering focal rows with dplyr</a>
    </li>
    <li>
      <a href="../articles/Inference_by_eye.html">Inference-by-eye using RA Fisher's Cat Data</a>
    </li>
    <li>
      <a href="../articles/merge_BBS_with_landcover.html">Data cleaning: Merging 2 large data sets with dplyr</a>
    </li>
    <li>
      <a href="../articles/reporting_paired_t_test_results.html">Running &amp; reporting paired t-tests in R</a>
    </li>
    <li>
      <a href="../articles/reporting_t_test_results.html">Reporting statistical result from a 2-sample t-test</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Data cleaning: Merging 2 large data sets with dplyr</h1>
            <h3 class="subtitle">Combining BBS bird counts &amp; landcover data</h3>
                        <h4 class="author">Nathan Brouwer <a href="mailto:brouwern@gmail.com">brouwern@gmail.com</a> <span class="citation">@lobrowR</span>
</h4>
            
            <h4 class="date">2017-11-20</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This vignette walks through the process of taking 2 complimentary sets of data and “merging” them using the powerful function full_join() in the package dplyr. We’ll take data on 1) the number of birds observed along USGS Breeding Bird Survey (BBS) routes and merge that ecological data with 2) geographic information on the types of landcover along those routes. In addition to this primary tasks of merging datasets, we’ll also do several other things to clean up the data to make it easy to use.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="books" class="section level3">
<h3 class="hasAnchor">
<a href="#books" class="anchor"></a>Books</h3>
<p>A good introduction to using dplyr is:</p>
<p>Beckerman et al’s book “Getting start with R: An introduction for biologists” 2nd ed.</p>
</div>
<div id="websites" class="section level3">
<h3 class="hasAnchor">
<a href="#websites" class="anchor"></a>Websites</h3>
<p>“Selecting columns and renaming are so easy with dplyr” <a href="https://blog.exploratory.io/selecting-columns-809bdd1ef615" class="uri">https://blog.exploratory.io/selecting-columns-809bdd1ef615</a></p>
</div>
</div>
<div id="learning-objectives" class="section level2">
<h2 class="hasAnchor">
<a href="#learning-objectives" class="anchor"></a>Learning objectives</h2>
<ul>
<li>Practice using the package dplyr
<ul>
<li>use dplyr pipes: %&gt;%</li>
</ul>
</li>
<li>General dataframe cleaning with dplyr
<ul>
<li>Select focal columns using select()</li>
<li>Select focal rows using filter()</li>
<li>Change columns names with rename()</li>
</ul>
</li>
<li>Merge 2 dataframes using full_join()</li>
<li>Plotting data using the ggpubr extension of ggplot2</li>
</ul>
</div>
<div id="packages" class="section level2">
<h2 class="hasAnchor">
<a href="#packages" class="anchor"></a>Packages</h2>
<ul>
<li>dplry</li>
<li>ggplot2</li>
<li>ggpubr</li>
<li>wildlifeR</li>
</ul>
</div>
<div id="r-code" class="section level2">
<h2 class="hasAnchor">
<a href="#r-code" class="anchor"></a>R code</h2>
<div id="load-libraries" class="section level3">
<h3 class="hasAnchor">
<a href="#load-libraries" class="anchor"></a>Load Libraries</h3>
<p>BBS and landcover data for Pennsylvania are in the wildlifeR package, and we’ll use the dplyr package to “reshape” into the proper format for analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(wildlifeR)</code></pre></div>
</div>
<div id="data" class="section level3">
<h3 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h3>
<p>We’ll use 2 datasets:</p>
<ol style="list-style-type: decimal">
<li>Bird counts from the BBS data for PA, and</li>
<li>USGS landcover classifications (eg urban, deciduous forest, etc) for a “buffer” 1 km around each BBS route in PA.</li>
</ol>
<p>You can learn more about these data sets using the help command ?BBS_PA and “BBS_PA_landcover_1km”.</p>
<p>Load both sets of data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## BBS data for PA
<span class="kw">data</span>(BBS_PA)

##Landcover data for BBS routes in PA
<span class="kw">data</span>(BBS_PA_landcover_1km)</code></pre></div>
</div>
<div id="look-at-the-bbs_pa-dataframes" class="section level3">
<h3 class="hasAnchor">
<a href="#look-at-the-bbs_pa-dataframes" class="anchor"></a>Look at the BBS_PA dataframes</h3>
<div id="definitions-of" class="section level4">
<h4 class="hasAnchor">
<a href="#definitions-of" class="anchor"></a>Definitions of</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(BBS_PA)</code></pre></div>
<pre><code>##   countrynum statenum Route RPID Year  Aou StopTotal SpeciesTotal
## 1        840       72     1  101 1970 1940         2            2
## 2        840       72     1  101 1970 2730         1            1
## 3        840       72     1  101 1970 3091         2            2
## 4        840       72     1  101 1970 3131         1            1
## 5        840       72     1  101 1970 3160        21           30
## 6        840       72     1  101 1970 3250         1            2</code></pre>
<p>For our work, the important columns are</p>
<ul>
<li>Route: a categorical variables that defines the unique ID of each route in the State of PA</li>
<li>Year: a numeric varibles that defines the year the data were collected. The minmum is 1966. This is a potential focal predictor variable for examining change over time.</li>
<li>Aou: a code that designates each species, as defined by the American Ornithological Union (AOU). (Note that ths A is uppercase while the rest is lowercase)</li>
<li>SpeciesTotal: the total number of individuals of a given species that were observed on a given route. This will be our focal response variable.</li>
</ul>
<p>(NOTE: We will <strong>not</strong> be using the “StopTotal” column. A BBS routes is composed of 50 point counts, called “stops.” StopTotal is the total number of stops out of 50 on which a given species in a given year was observed. Its max value is 50, or 100% of the 50 stops on the route)</p>
<p>see ?BBS_PA for more information on these variables</p>
</div>
<div id="size-of-bbs_pa-dataframe" class="section level4">
<h4 class="hasAnchor">
<a href="#size-of-bbs_pa-dataframe" class="anchor"></a>Size of BBS_PA dataframe</h4>
<p>Thes BBS data is really really big dataset!:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(BBS_PA)</code></pre></div>
<pre><code>## [1] 244185      8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(BBS_PA)</code></pre></div>
<pre><code>##    countrynum     statenum      Route            RPID            Year     
##  Min.   :840   Min.   :72   Min.   :  1.0   Min.   :101.0   Min.   :1966  
##  1st Qu.:840   1st Qu.:72   1st Qu.: 31.0   1st Qu.:101.0   1st Qu.:1984  
##  Median :840   Median :72   Median : 58.0   Median :101.0   Median :1997  
##  Mean   :840   Mean   :72   Mean   :107.5   Mean   :101.1   Mean   :1995  
##  3rd Qu.:840   3rd Qu.:72   3rd Qu.: 90.0   3rd Qu.:101.0   3rd Qu.:2007  
##  Max.   :840   Max.   :72   Max.   :911.0   Max.   :203.0   Max.   :2016  
##       Aou          StopTotal       SpeciesTotal   
##  Min.   :   60   Min.   : 1.000   Min.   :  1.00  
##  1st Qu.: 4610   1st Qu.: 2.000   1st Qu.:  2.00  
##  Median : 5630   Median : 4.000   Median :  5.00  
##  Mean   : 5493   Mean   : 7.239   Mean   : 13.78  
##  3rd Qu.: 6670   3rd Qu.:10.000   3rd Qu.: 15.00  
##  Max.   :22860   Max.   :50.000   Max.   :992.00</code></pre>
<p>There are so many rows b/c</p>
<ul>
<li>There are 50 years of data.</li>
<li>There are 202 species of birds observed during the BBS in Pennsylvania</li>
<li>There are 137 routes in Pennsylvania</li>
</ul>
<p>Note, however, that if you multiply years<em>species</em>routes you get an even <strong>bigger</strong> number.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">50</span><span class="op">*</span><span class="dv">202</span><span class="op">*</span><span class="dv">137</span></code></pre></div>
<pre><code>## [1] 1383700</code></pre>
<p>This is because</p>
<ul>
<li>The number of routes has changed over time</li>
<li>Data are only given for a species if it was obseved on a route</li>
</ul>
<p>Any important consequence of this is that there are only data on a species when it is actually obseved. So if a bird is see on route 99 in 2015 but not 2016, there is a row of data for it in 2015 but not 2016. Therefore, there are <strong>no zeros</strong> in the StopTotal column, which gives the number of of each species seen on a route in a given year.</p>
<p>We can see using summary() that the minimum value in the StopTotal column is indeed 1; not a single zero.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(BBS_PA<span class="op">$</span>StopTotal)</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.000   2.000   4.000   7.239  10.000  50.000</code></pre>
</div>
</div>
</div>
<div id="isolate-focal-columns" class="section level2">
<h2 class="hasAnchor">
<a href="#isolate-focal-columns" class="anchor"></a>Isolate focal columns</h2>
<ul>
<li>For our analyses we don’t need every column in the dataset</li>
<li>Let’s look at the Year, Aou species code, Route number, and SpeciesTotal columns
<ul>
<li>All the data are from the state of Pennsyvlvania in the USA, so we don’t need these columns.</li>
</ul>
</li>
<li>We can use the select() function from the dplyr package to isolate the columns we want.</li>
<li>We tell dplyr the dataframe we want to work on, BBS_PA, add a “pipe” %&gt;%, and then use the select() command to tell it the columns within the dataframe we want.</li>
<li>We’ll save them into a new object called BBS_PA2</li>
<li>Note that the “A” in “Aou”" is uppercase while the rest are lowercase)</li>
<li>See page 60-61 in Beckerman et al’s book “Getting start with R: An introduction for biologists” for more info on select()</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#load dplyr if you haven't already</span>
<span class="co">#library(dplyr)</span>

<span class="co">#look at the names of the full dataframe</span>
<span class="kw">names</span>(BBS_PA)</code></pre></div>
<pre><code>## [1] "countrynum"   "statenum"     "Route"        "RPID"        
## [5] "Year"         "Aou"          "StopTotal"    "SpeciesTotal"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#use select() to isolate focal columns</span>
## and put into a new dataframe
##(Note that ths A in Aou is uppercase 
## while the rest of the letters are lowercase)

<span class="co">#BBS_PA2 &lt;-  select(.data = BBS_PA,</span>
<span class="co">#                   Year, Aou, Route, SpeciesTotal)</span>

<span class="co">#dplyr was not working for me so I did this another way of doing</span>
<span class="co">#this</span>

BBS_PA2 &lt;-<span class="st"> </span>BBS_PA[,<span class="kw">c</span>(<span class="st">"Year"</span>, <span class="st">"Aou"</span>, <span class="st">"Route"</span>, <span class="st">"SpeciesTotal"</span>)]

<span class="co">#look at columns in new dataframe</span>
<span class="kw">names</span>(BBS_PA2)</code></pre></div>
<pre><code>## [1] "Year"         "Aou"          "Route"        "SpeciesTotal"</code></pre>
<div id="isolate-focal-species-using-filter" class="section level3">
<h3 class="hasAnchor">
<a href="#isolate-focal-species-using-filter" class="anchor"></a>Isolate focal species using filter()</h3>
<ul>
<li>Each row is data on a different combination of: a species, a year, and a route</li>
<li>We want to isolate rows that just relate to our focal species; we’ll use the Scarlet Tanager</li>
<li>The AOU (American ornithological Union) code for the Scarlet Tanager (SCTA) is 6080.<br>
</li>
<li>We can tell R to just give us data on SCTA using the fliter() command in the dplyr package.</li>
<li>See page 62-65 in Beckerman et al’s book “Getting start with R: An introduction for biologists” for more info on filter()</li>
</ul>
<div id="an-example-bbs-dataframe" class="section level4">
<h4 class="hasAnchor">
<a href="#an-example-bbs-dataframe" class="anchor"></a>An example BBS dataframe</h4>
<ul>
<li>The following dataframe is a mock up of the general structure of the BBS data.</li>
<li>In the “Aou” column are listed several numbers: 5980, 6080, 5950, 6110, and several others
<ul>
<li>Each one of these numbers represents a different species</li>
<li>We want to isolate just teh codes 6080, which represent the scarlet tanager</li>
<li>We want to discard the rest</li>
</ul>
</li>
</ul>
<pre><code>##      Year  Aou Route SpeciesTotal                 
## 2910 2011 5980     2           10                 
## 2974 2012 5980     2            9                 
## 3047 2013 5980     2            6                 
## 2911 2011 6080     2            3 we want this row
## 2909 2011 5950     2            4                 
## 2973 2012 5950     2            1                 
## 3046 2013 5950     2            5                 
## 2975 2012 6080     2            3 we want this row
## 2912 2011 6110     2            1                 
## 2976 2012 6110     2            3                 
## 3049 2013 6130     2           23                 
## 3048 2013 6080     2            3 we want this row
## 2913 2011 6120     2            4                 
## 2977 2012 6120     2            2                 
## 3050 2013 6140     2            7</code></pre>
<p>That is, we want this</p>
<pre><code>##   Year  Aou Route SpeciesTotal                 
## 1 2011 6080     2            3 we want this row
## 2 2012 6080     2            3 we want this row
## 3 2013 6080     2            3 we want this row</code></pre>
</div>
</div>
<div id="select-just-focal-rows-with-dplyrfilter" class="section level3">
<h3 class="hasAnchor">
<a href="#select-just-focal-rows-with-dplyrfilter" class="anchor"></a>Select just focal rows with dplyr::filter()</h3>
<div id="focal-bird-rows-6080-the-scarlet-tanager" class="section level4">
<h4 class="hasAnchor">
<a href="#focal-bird-rows-6080-the-scarlet-tanager" class="anchor"></a>Focal bird rows: 6080, the scarlet tanager</h4>
<ul>
<li>Again, the “%&gt;%” is called a pipe that connects the dataframe BBS_PA2 with the filter() command</li>
<li>“==” in the filter() commands means “exactly equals”</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

BBS_PA_SCTA &lt;-<span class="st"> </span>BBS_PA2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Aou <span class="op">==</span><span class="st"> </span><span class="dv">6080</span>)</code></pre></div>
</div>
<div id="plot-filtered-bbs-data" class="section level4">
<h4 class="hasAnchor">
<a href="#plot-filtered-bbs-data" class="anchor"></a>Plot filtered BBS data</h4>
<p>We can see how many birds were observed on all the routes each year using ggscatter() from the ggpubr() package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(ggpubr)

<span class="kw">ggscatter</span>(<span class="dt">data =</span> BBS_PA_SCTA,
          <span class="dt">y =</span> <span class="st">"SpeciesTotal"</span>,
          <span class="dt">x =</span> <span class="st">"Year"</span>)</code></pre></div>
<p><img src="merge_BBS_with_landcover_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>Note however that as discussed above this dataframe only contains data from routes where SCTA was observed; when SCTA wasn’t observed, nothing is recored at all, hence no zeros. We can see this with summary()</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(BBS_PA_SCTA)</code></pre></div>
<pre><code>##       Year           Aou           Route        SpeciesTotal   
##  Min.   :1966   Min.   :6080   Min.   :  1.0   Min.   : 1.000  
##  1st Qu.:1983   1st Qu.:6080   1st Qu.: 29.0   1st Qu.: 3.000  
##  Median :1996   Median :6080   Median : 56.0   Median : 7.000  
##  Mean   :1995   Mean   :6080   Mean   :113.3   Mean   : 8.566  
##  3rd Qu.:2007   3rd Qu.:6080   3rd Qu.: 88.5   3rd Qu.:12.000  
##  Max.   :2016   Max.   :6080   Max.   :911.0   Max.   :44.000</code></pre>
<p>Or by looking at a histogram</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gghistogram</span>(BBS_PA_SCTA,
            <span class="dt">x =</span> <span class="st">"SpeciesTotal"</span>)</code></pre></div>
<p><img src="merge_BBS_with_landcover_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
<div id="focal-year-rows" class="section level4">
<h4 class="hasAnchor">
<a href="#focal-year-rows" class="anchor"></a>Focal year rows</h4>
<p>For this exercise we are only going to consider data from 2006, since that is the year that the landcover data we’ll be merging with comes from. (notes that “Year” has a capital “Y” while the rest is lowercase).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_SCTA_<span class="dv">2</span> &lt;-<span class="st"> </span>BBS_PA_SCTA <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Year <span class="op">==</span><span class="st"> </span><span class="dv">2006</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_SCTA_<span class="dv">2</span> &lt;-<span class="st"> </span>BBS_PA_SCTA <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Year <span class="op">==</span><span class="st"> </span><span class="dv">2006</span>)</code></pre></div>
<p>We can see that we’ve greatly reduced the size of the original dataframe</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(BBS_PA)</code></pre></div>
<pre><code>## [1] 244185      8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(BBS_PA_SCTA)</code></pre></div>
<pre><code>## [1] 3535    4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(BBS_PA_SCTA_<span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] 82  4</code></pre>
</div>
<div id="plot-filtered-scta-data" class="section level4">
<h4 class="hasAnchor">
<a href="#plot-filtered-scta-data" class="anchor"></a>Plot filtered SCTA data</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gghistogram</span>(<span class="dt">data =</span> BBS_PA_SCTA_<span class="dv">2</span>,
          <span class="dt">x =</span> <span class="st">"SpeciesTotal"</span>)</code></pre></div>
<pre><code>## Warning: Using `bins = 30` by default. Pick better value with the argument
## `bins`.</code></pre>
<p><img src="merge_BBS_with_landcover_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
</div>
</div>
<div id="clean-landcover-data" class="section level3">
<h3 class="hasAnchor">
<a href="#clean-landcover-data" class="anchor"></a>Clean Landcover data</h3>
<ul>
<li>We’ll step back from the bird data now and switch to the data on the type of landcover surrounding the BBS routes.</li>
<li>There are a large number of columns of data in the landcover dataframe</li>
<li>Note that a couple of the columns names aren’t very good: “RT..NAME” and “RT..LENG.”</li>
<li>Columns that start with “NLCD” have data on the number of pixels of a certain land cover class surrounding a rounte. There are about 15 or so of these, for everything from open water to tundra.</li>
<li>See ?BBS_PA_landcover_1km for infromation on each of these</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(BBS_PA_landcover_1km)</code></pre></div>
<pre><code>##  [1] "Route"     "BCR"       "State"     "RT..NAME"  "RT..LENG."
##  [6] "NLCD.0"    "NLCD.11"   "NLCD.12"   "NLCD.21"   "NLCD.22"  
## [11] "NLCD.23"   "NLCD.24"   "NLCD.31"   "NLCD.41"   "NLCD.42"  
## [16] "NLCD.43"   "NLCD.52"   "NLCD.71"   "NLCD.81"   "NLCD.82"  
## [21] "NLCD.90"   "NLCD.95"   "SUM"</code></pre>
<div id="isoalte-focal-columnsforest-cover" class="section level4">
<h4 class="hasAnchor">
<a href="#isoalte-focal-columnsforest-cover" class="anchor"></a>Isoalte focal columns:forest cover</h4>
<p>Let’s focus on the columns that pertain to forest cover, which are contained in columns NLCD41, NLCD42, NLCD43. These represent three different types of forest, eg deciduous, coniferous, mixed. You find out information on them from the help file for the dataset using ?BBS_PA_landcover_1km.</p>
<p>We can subset these columns as we did for the BBS bird count data using using select(). Note that there is a period between “NLCD” and the number, and that “SUM” is in all caps.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_landcover_1km_<span class="dv">2</span> &lt;-<span class="st"> </span>BBS_PA_landcover_1km <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Route, NLCD.<span class="dv">41</span>, NLCD.<span class="dv">42</span>, NLCD.<span class="dv">43</span>, SUM)</code></pre></div>
</div>
<div id="add-up-total-forest-cover" class="section level4">
<h4 class="hasAnchor">
<a href="#add-up-total-forest-cover" class="anchor"></a>Add up total forest cover</h4>
<p>Let’s add up the NLCD.41, NLCD.42, and NLCD.43 columns</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">forest.total &lt;-<span class="st"> </span><span class="kw">rowSums</span>(BBS_PA_landcover_1km_<span class="dv">2</span>[<span class="kw">c</span>(<span class="st">"NLCD.41"</span>,
                                 <span class="st">"NLCD.42"</span>,
                                  <span class="st">"NLCD.43"</span>)])</code></pre></div>
<p>We can add this new column to the dataframe like this</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_landcover_1km_<span class="dv">2</span><span class="op">$</span>forest.total &lt;-<span class="st"> </span>forest.total</code></pre></div>
<p>And see that it’s there using head()</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(BBS_PA_landcover_1km_<span class="dv">2</span>)</code></pre></div>
<pre><code>##   Route NLCD.41 NLCD.42 NLCD.43   SUM forest.total
## 1     1   44953     563     797 98591        46313
## 2     2   25119    1130      48 82345        26297
## 3     3   34154     521      78 86328        34753
## 4     4   39813    1695      60 88526        41568
## 5     5   32244    5892    3518 97708        41654
## 6     6   50529    4674   13320 87503        68523</code></pre>
<p>The “SUM” column tells us the total number of GIS pixels were actually used to determine all of the landcover in the BBS_PA_landcover_1km_2 dataframe. This varies a bit so we will actually want to use the percentage of forest cover, not the raw total. We can calcautle the percentage like this</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">forest.percent &lt;-<span class="st"> </span>BBS_PA_landcover_1km_<span class="dv">2</span><span class="op">$</span>forest.total <span class="op">/</span><span class="st"> </span>BBS_PA_landcover_1km_<span class="dv">2</span><span class="op">$</span>SUM</code></pre></div>
<p>And add it to the dataframe like this</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_landcover_1km_<span class="dv">2</span><span class="op">$</span>forest.percent &lt;-<span class="st"> </span>forest.percent</code></pre></div>
<p>Note that we can actually do the math and add the new data to the dataframe in one step like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_landcover_1km_<span class="dv">2</span><span class="op">$</span>forest.percent &lt;-<span class="st"> </span>BBS_PA_landcover_1km_<span class="dv">2</span><span class="op">$</span>forest.total <span class="op">/</span><span class="st"> </span>BBS_PA_landcover_1km_<span class="dv">2</span><span class="op">$</span>SUM</code></pre></div>
<p>We don’t need the individual columns for each of the three cover classes anymore (NCLD.41, 42, 43) so we can use select() to focus just on our new forest.percent and forest.total columns</p>
<p>We’ll call this new dataframe BBS_PA_landcover_1km_3</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_landcover_1km_<span class="dv">3</span> &lt;-<span class="st"> </span>BBS_PA_landcover_1km_<span class="dv">2</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(Route, forest.total, SUM, forest.percent,
         NLCD.<span class="dv">41</span>,NLCD.<span class="dv">42</span>,NLCD.<span class="dv">43</span>)</code></pre></div>
</div>
</div>
<div id="merge-bbs-data-and-landcover-data" class="section level3">
<h3 class="hasAnchor">
<a href="#merge-bbs-data-and-landcover-data" class="anchor"></a>Merge BBS data and landcover data</h3>
<p>We have reduced the size and made changes two dataframe: BBS_PA, with counts of birds, and BBS_PA_landcover_1km, which has information on the habitats around BBS routes in PA.</p>
<p>Now we’ll make a new dataframe that <em>combines</em> these two sperate data sets. This is one of the most powerful features of R - taking big sets of data and with a few lines of codes merging them into a new data set.</p>
<p>We’ll do this using thhe full_join() command from the dplyr package. All we need to do is 1) tell full_joing the names of the two data sets and 2) tell the function what column is shared between the data setst.</p>
<p>The fact that the “Route” column occurs in both data sets allows them to be matached up.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_SCTA_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">full_join</span>(BBS_PA_SCTA_<span class="dv">2</span> ,
                       BBS_PA_landcover_1km_<span class="dv">3</span>, 
                       <span class="dt">by =</span> <span class="st">"Route"</span>)</code></pre></div>
<p>Look at the dataframe</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(BBS_PA_SCTA_<span class="dv">3</span>)</code></pre></div>
<pre><code>##   Year  Aou Route SpeciesTotal forest.total   SUM forest.percent NLCD.41
## 1 2006 6080     2            6        26297 82345      0.3193515   25119
## 2 2006 6080     3            6        34753 86328      0.4025693   34154
## 3 2006 6080     4            3        41568 88526      0.4695570   39813
## 4 2006 6080     5            1        41654 97708      0.4263110   32244
## 5 2006 6080     6            8        68523 87503      0.7830932   50529
## 6 2006 6080     8            5        56098 87248      0.6429718   49029
##   NLCD.42 NLCD.43
## 1    1130      48
## 2     521      78
## 3    1695      60
## 4    5892    3518
## 5    4674   13320
## 6    4304    2765</code></pre>
<p>Compare the size of this dataframe and the original landcover dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#the BBS data that were merged</span>
<span class="kw">dim</span>(BBS_PA_SCTA_<span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] 82  4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#the landcover data that were merged</span>
<span class="kw">dim</span>(BBS_PA_landcover_1km_<span class="dv">3</span>)</code></pre></div>
<pre><code>## [1] 137   7</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#the final merged dataframe</span>
<span class="kw">dim</span>(BBS_PA_SCTA_<span class="dv">3</span>)</code></pre></div>
<pre><code>## [1] 137  10</code></pre>
</div>
<div id="dealing-with-nas" class="section level3">
<h3 class="hasAnchor">
<a href="#dealing-with-nas" class="anchor"></a>Dealing with NAs</h3>
<p>If we look at our new dataframe we see that some of our rows now contains NAs</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(BBS_PA_SCTA_<span class="dv">3</span>)</code></pre></div>
<pre><code>##       Year           Aou           Route        SpeciesTotal   
##  Min.   :2006   Min.   :6080   Min.   :  1.0   Min.   : 1.000  
##  1st Qu.:2006   1st Qu.:6080   1st Qu.: 35.0   1st Qu.: 3.000  
##  Median :2006   Median :6080   Median : 69.0   Median : 6.000  
##  Mean   :2006   Mean   :6080   Mean   :137.2   Mean   : 8.341  
##  3rd Qu.:2006   3rd Qu.:6080   3rd Qu.:132.0   3rd Qu.:10.000  
##  Max.   :2006   Max.   :6080   Max.   :911.0   Max.   :42.000  
##  NA's   :55     NA's   :55                     NA's   :55      
##   forest.total        SUM         forest.percent       NLCD.41     
##  Min.   : 1563   Min.   : 63828   Min.   :0.01881   Min.   : 1377  
##  1st Qu.:35308   1st Qu.: 84435   1st Qu.:0.40257   1st Qu.:27990  
##  Median :51222   Median : 87008   Median :0.59019   Median :40555  
##  Mean   :47706   Mean   : 86994   Mean   :0.55450   Mean   :39383  
##  3rd Qu.:62998   3rd Qu.: 89201   3rd Qu.:0.71135   3rd Qu.:50529  
##  Max.   :84033   Max.   :110663   Max.   :0.96461   Max.   :73426  
##                                                                    
##     NLCD.42         NLCD.43     
##  Min.   :   59   Min.   :    0  
##  1st Qu.:  572   1st Qu.:  531  
##  Median : 1707   Median : 1579  
##  Mean   : 2891   Mean   : 5432  
##  3rd Qu.: 4871   3rd Qu.: 8346  
##  Max.   :11389   Max.   :39534  
## </code></pre>
<p>This occured b/c the original BBS data only contains data when a species is observed - if it isn’t seen, nothing is entered. So each “NA” in the new dataframe we made represents a route for which, in 2006, the SCTA wasn’t observed.</p>
<p>Its easy to fix the Year and Aou columns because the all have the same values. All of the years = 2006, and all of the Aou columns = 6080, for Scarlet tanager. The following code will fill in any of the missing values</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_SCTA_<span class="dv">3</span><span class="op">$</span>Year &lt;-<span class="st"> </span><span class="dv">2006</span>
BBS_PA_SCTA_<span class="dv">3</span><span class="op">$</span>Aou &lt;-<span class="st"> </span><span class="dv">6080</span></code></pre></div>
<p>Actualy, since the code “6080” isn’t very meaningful, let’s add the letters “SCTA” to a column to make it easy to remembe what we are looking at. Let’s make a new column called “name” and put “SCTA” in it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_SCTA_<span class="dv">3</span><span class="op">$</span>name &lt;-<span class="st"> "SCTA"</span></code></pre></div>
<p>We’ll make this a factor variable</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_SCTA_<span class="dv">3</span><span class="op">$</span>name &lt;-<span class="st"> </span><span class="kw">factor</span>(BBS_PA_SCTA_<span class="dv">3</span><span class="op">$</span>name)</code></pre></div>
<p>Summary will show us what we’ver done: now there are no NAs in Year or Aou and there’s a new column calld name</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(BBS_PA_SCTA_<span class="dv">3</span>)</code></pre></div>
<pre><code>##       Year           Aou           Route        SpeciesTotal   
##  Min.   :2006   Min.   :6080   Min.   :  1.0   Min.   : 1.000  
##  1st Qu.:2006   1st Qu.:6080   1st Qu.: 35.0   1st Qu.: 3.000  
##  Median :2006   Median :6080   Median : 69.0   Median : 6.000  
##  Mean   :2006   Mean   :6080   Mean   :137.2   Mean   : 8.341  
##  3rd Qu.:2006   3rd Qu.:6080   3rd Qu.:132.0   3rd Qu.:10.000  
##  Max.   :2006   Max.   :6080   Max.   :911.0   Max.   :42.000  
##                                                NA's   :55      
##   forest.total        SUM         forest.percent       NLCD.41     
##  Min.   : 1563   Min.   : 63828   Min.   :0.01881   Min.   : 1377  
##  1st Qu.:35308   1st Qu.: 84435   1st Qu.:0.40257   1st Qu.:27990  
##  Median :51222   Median : 87008   Median :0.59019   Median :40555  
##  Mean   :47706   Mean   : 86994   Mean   :0.55450   Mean   :39383  
##  3rd Qu.:62998   3rd Qu.: 89201   3rd Qu.:0.71135   3rd Qu.:50529  
##  Max.   :84033   Max.   :110663   Max.   :0.96461   Max.   :73426  
##                                                                    
##     NLCD.42         NLCD.43        name    
##  Min.   :   59   Min.   :    0   SCTA:137  
##  1st Qu.:  572   1st Qu.:  531             
##  Median : 1707   Median : 1579             
##  Mean   : 2891   Mean   : 5432             
##  3rd Qu.: 4871   3rd Qu.: 8346             
##  Max.   :11389   Max.   :39534             
## </code></pre>
<p>To fill in the NAs for the SpeciesTotal column (the counts of the number of birds) requires a new function: is.na(). is.na() determiens if a row in a column has NA or it doesn’t. is.na() returns “TRUE” whenever there is an NA</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.na</span>(BBS_PA_SCTA_<span class="dv">3</span><span class="op">$</span>SpeciesTotal)</code></pre></div>
<pre><code>##   [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [12] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [23] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [34] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [45] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [56] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [67] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [78] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [89]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [100]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [111]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [122]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [133]  TRUE  TRUE  TRUE  TRUE  TRUE</code></pre>
<p>We can use is.na with a function from dplyr called mutate() to change these NAs to 0s.</p>
<p><strong>This code is pretty complex, actually, so don’t worry if you don’t get it the 1st try</strong> Actually, since its pretty trick for beginers, I’ve made a new function that does it more simply (see next chunk of code)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_SCTA_<span class="dv">4</span> &lt;-<span class="st">  </span>BBS_PA_SCTA_<span class="dv">3</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">SpeciesTotal =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(SpeciesTotal),<span class="dv">0</span>,SpeciesTotal))</code></pre></div>
<p>Since the above code is rather long, the following function from the wildlifeR package will do the same thing</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_SCTA_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/NA_to_zero.html">NA_to_zero</a></span>(<span class="dt">dat =</span> BBS_PA_SCTA_<span class="dv">3</span>,
           <span class="dt">column =</span> <span class="st">"SpeciesTotal"</span>)</code></pre></div>
</div>
<div id="plot-relationship-between-scta-and-forest-cover" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-relationship-between-scta-and-forest-cover" class="anchor"></a>PLot relationship between SCTA and forest cover</h3>
<p>We can now finally check out the relationship between the Scarlet tanger and forest cover</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggscatter</span>(<span class="dt">data =</span> BBS_PA_SCTA_<span class="dv">3</span>,
          <span class="dt">y =</span> <span class="st">"SpeciesTotal"</span>,
          <span class="dt">x =</span> <span class="st">"forest.percent"</span>)</code></pre></div>
<p><img src="merge_BBS_with_landcover_files/figure-html/unnamed-chunk-40-1.png" width="672"></p>
</div>
<div id="re-orgainzing-rows" class="section level3">
<h3 class="hasAnchor">
<a href="#re-orgainzing-rows" class="anchor"></a>Re-orgainzing rows</h3>
<ul>
<li>Dataframes typically put the information columns to the left and the data columns to the right</li>
<li>We can reorder our columns in BBS_PA_SCTA_3 using select()</li>
<li>We can also rename columns using the selection function using the format “new.name = old.name”</li>
<li>Its generally good to use a consistent format for all of your column names</li>
<li>I also think its good to avoid uppercase letters</li>
<li>Using using standard abbreviations is also good b/c shorter names are easier to type; here I’ll use “spp” instead of “speices” , “for” instead of forest, and “tot” instead of “total”</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_SCTA_<span class="dv">4</span> &lt;-<span class="st"> </span>BBS_PA_SCTA_<span class="dv">3</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="dt">year =</span> Year, 
                              <span class="dt">aou =</span> Aou, 
                              <span class="dt">route =</span> Route, 
                              <span class="dt">name =</span> name,
                              <span class="dt">spp.tot =</span> SpeciesTotal,
                              <span class="dt">for.tot =</span> forest.total,
                              <span class="dt">NLCD.sum =</span> SUM,
                              <span class="dt">for.percent =</span> forest.percent)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BBS_PA_SCTA_<span class="dv">4</span> &lt;-<span class="st"> </span>BBS_PA_SCTA_<span class="dv">3</span> <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="dt">year =</span> Year, 
                              <span class="dt">aou =</span> Aou, 
                              <span class="dt">route =</span> Route, 
                              <span class="dt">name =</span> name,
                              <span class="dt">spp.tot =</span> SpeciesTotal,
                              <span class="dt">for.tot =</span> forest.total,
                              <span class="dt">NLCD.sum =</span> SUM,
                              <span class="dt">for.percent =</span> forest.percent)</code></pre></div>
</div>
<div id="saving-to--csv" class="section level3">
<h3 class="hasAnchor">
<a href="#saving-to--csv" class="anchor"></a>Saving to .csv</h3>
<p>When we have a dataset prepared its a good idea to save it to a spreadsheet as a .csv file for safe keeping. This is done with the write.csv() function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv</span>(BBS_PA_SCTA_<span class="dv">4</span>, <span class="dt">file =</span> <span class="st">"SCTA_vs_forest_cover.csv"</span>)</code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#learning-objectives">Learning objectives</a></li>
      <li><a href="#packages">Packages</a></li>
      <li><a href="#r-code">R code</a></li>
      <li><a href="#isolate-focal-columns">Isolate focal columns</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Brouwer Nathan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
